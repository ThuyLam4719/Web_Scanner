{% extends "base.html" %}
{% block content %}
<h2>NHẬP URL</h2>

<form id="scanForm">
    <input type="text" name="url" placeholder="Nhập URL cần quét" required>
    <button type="submit">Quét</button>
</form>

<div id="loading-spinner" style="display:none;justify-content:center;align-items:center;margin:18px 0;">
    <div class="spinner"></div>
    <span style="margin-left:12px;color:var(--primary);font-weight:600;">Đang quét...</span>
</div>

<div id="result-short"></div>
<div id="result-full" class="result-box" style="display: none;"></div>

<script>
    const form = document.getElementById("scanForm");
    const shortDiv = document.getElementById("result-short");
    const fullDiv = document.getElementById("result-full");
    const spinner = document.getElementById("loading-spinner");

    form.addEventListener("submit", function (e) {
        e.preventDefault();
        shortDiv.innerHTML = "";
        fullDiv.style.display = "none";
        spinner.style.display = "flex";
        const formData = new FormData(form);
        fetch("/scan", {
            method: "POST",
            body: formData
        })
            .then(res => res.json())
            .then(data => {
                spinner.style.display = "none";
                if (data.success) {
                    shortDiv.innerHTML = `<strong style='color:var(--primary);font-size:1.1em;'>==&gt;&gt; ${data.short}</strong>`;
                    fullDiv.innerHTML = `<pre style='white-space:pre-wrap;margin:0;'>${data.full.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`;
                    fullDiv.style.display = "block";
                } else {
                    shortDiv.innerHTML = `<span style="color:red;">Lỗi: ${data.error}</span>`;
                    fullDiv.style.display = "none";
                }
            })
            .catch(err => {
                spinner.style.display = "none";
                shortDiv.innerHTML = `<span style="color:red;">Lỗi kết nối!</span>`;
                fullDiv.style.display = "none";
            });
    });
</script>
{% endblock %}